---
title: "Relatório de análise estatística - Old Town Road LTDA"

# Nome do documento PDF gerado
output-file: titulo do projeto
documentclass: ./estat/estat
---

```{r setup}
#| include: false
source("rdocs/source/packages.R")
library(ggplot2)
library(dplyr)
library(readxl)
library(kableExtra)
library(tinytex)
```

# Introdução

O seguinte relatório estatístico foi elaborado a pedido de João Sábio, proprietário da Old Town Road Ltda., uma holding que administra diversas empresas voltadas ao comércio no faroeste. O cliente demonstrou interesse em expandir seus investimentos para uma nova região e, para elaborar suas decisões, solicitou a realização de análises estatísticas descritivas e inferenciais que permitam compreender melhor o comportamento do mercado local, o perfil dos clientes e o desempenho comercial das lojas dessa área.

As análises foram desenvolvidas a partir de um banco de dados disponibilizado e coletado pelo próprio cliente, contendo informações sobre receitas anuais específicas, características físicas dos consumidores, distribuição etária e volume de vendas de produtos.

Todo o processamento e geração dos resultados foram realizados no software R, utilizando a versão mais recente disponível no momento da elaboração, por meio da ferramenta Quarto para integração entre código, texto e formatação automática dos resultados. O nível de significância adotado foi de 5% (α = 0,05) para todas as inferências estatísticas realizadas.

Atendendo às solicitações do cliente, o relatório está dividido em quatro análises principais: Receita média das lojas registrada nos anos de 1880 a 1889, Variação de peso por altura dos clientes, Idade dos clientes de Âmbar Seco a depender da loja e Os três produtos mais vendidos nas três lojas com maior receita em 1889.

# Metodologia

Este relatório é composto por técnicas estatísticas que serão descristas a seguir de acordo com o que foi utilizado em tal estudo:
 
## Frequência Relativa

A frequência relativa é utilizada para a comparação entre classes de uma variável categórica com $c$ categorias, ou para comparar uma mesma categoria em diferentes estudos.

A frequência relativa da categoria $j$ é dada por:

$$
f_j=\frac{n_j}{n}
$$

Com:

-   $j = 1, \, ..., \, c$

-   $n_j =$ número de observações da categoria $j$

-   $n =$ número total de observações

Geralmente, a frequência relativa é utilizada em porcentagem, dada por:

$$100 \times f_j$$

## Média

A média é a soma das observações dividida pelo número total delas, dada pela fórmula:

$$\bar{X}=\frac{\sum\limits_{i=1}^{n}X_i}{n}$$

Com:

-   $i = 1, \, 2, \, ..., \, n$

-   $n =$ número total de observações

## Mediana

Sejam as $n$ observações de um conjunto de dados $X=X_{(1)},X_{(2)},\ldots, X_{(n)}$ de determinada variável ordenadas de forma crescente. A mediana do conjunto de dados $X$ é o valor que deixa metade das observações abaixo dela e metade dos dados acima.

Com isso, pode-se calcular a mediana da seguinte forma:

$$
med(X) =
    \begin{cases}
         X_{\frac{n+1}{2}}, \textrm{para n ímpar} \\
         \frac{X_{\frac{n}{2}}+X_{\frac{n}{2} + 1}}{2}, \textrm{para n par} \\
    \end{cases}
$$

## Quartis

Os quartis são separatrizes que dividem o conjunto de dados em quatro partes iguais. O primeiro quartil (ou inferior) delimita os 25% menores valores, o segundo representa a mediana, e o terceiro delimita os 25% maiores valores. Inicialmente deve-se calcular a posição do quartil:

-   Posição do primeiro quartil $P_1$: $$P_1=\frac{n+1}{4}$$

-   Posição da mediana (segundo quartil) $P_2$: $$P_2 = \frac{n+1}{2}$$

-   Posição do terceiro quartil $P_3$: $$P_3=\frac{3 \times (n+1)}{4}$$

Com $n$ sendo o tamanho da amostra. Dessa forma, $X_{\left( P_i \right)}$ é o valor do $i$-ésimo quartil, onde $X_{\left( j \right)}$ representa a $j$-ésima observação dos dados ordenados.

Se o cálculo da posição resultar em uma fração, deve-se fazer a média entre o valor que está na posição do inteiro anterior e do seguinte ao da posição.

## Variância

A variância é uma medida que avalia o quanto os dados estão dispersos em relação à média, em uma escala ao quadrado da escala dos dados.

### Variância Amostral

Para uma amostra, a variância é dada por:

$$S^2=\frac{\sum\limits_{i=1}^{n}\left(X_i - \bar{X}\right)^2}{n-1}$$

Com:

-   $X_i =$ i-ésima observação da amostra

-   $\bar{X} =$ média amostral

-   $n =$ tamanho da amostra

## Desvio Padrão

O desvio padrão é a raiz quadrada da variância. Ele avalia o quanto os dados estão dispersos em relação à média.

### Desvio Padrão Amostral

Para uma amostra, o desvio padrão é dado por:

$$S=\sqrt{\frac{\sum\limits_{i=1}^{n}\left(X_i - \bar{X}\right)^2}{n-1}}$$

Com:

-   $X_i =$ i-ésima observação da amostra

-   $\bar{X} =$ média amostral

-   $n =$ tamanho da amostra

## Boxplot

O boxplot é uma representação gráfica na qual se pode perceber de forma mais clara como os dados estão distribuídos. A figura abaixo ilustra um exemplo de boxplot.

![Exemplo de boxplot](images/box_uni.png){fig-align="center"}

A porção inferior do retângulo diz respeito ao primeiro quartil, enquanto a superior indica o terceiro quartil. Já o traço no interior do retângulo representa a mediana do conjunto de dados, ou seja, o valor em que o conjunto de dados é dividido em dois subconjuntos de mesmo tamanho. A média é representada pelo losango branco e os pontos são *outliers*. Os *outliers* são valores discrepantes da série de dados, ou seja, valores que não demonstram a realidade de um conjunto de dados.

## Gráfico de Dispersão

O gráfico de dispersão é uma representação gráfica utilizada para ilustrar o comportamento conjunto de duas variáveis quantitativas. A figura abaixo ilustra um exemplo de gráfico de dispersão, onde cada ponto representa uma observação do banco de dados.

![Exemplo de Gráfico de Dispersão](images/disp_uni.png){fig-align="center"}

## Tipos de Variáveis

### Qualitativas

As variáveis qualitativas são as variáveis não numéricas, que representam categorias ou características da população. Estas subdividem-se em:

-   **Nominais**: quando não existe uma ordem entre as categorias da variável (exemplos: sexo, cor dos olhos, fumante ou não, etc)
-   **Ordinais**: quando existe uma ordem entre as categorias da variável (exemplos: nível de escolaridade, mês, estágio de doença, etc)

### Quantitativas

As variáveis quantitativas são as variáveis numéricas, que representam características numéricas da população, ou seja, quantidades. Estas subdividem-se em:

-   **Discretas**: quando os possíveis valores são enumeráveis (exemplos: número de filhos, número de cigarros fumados, etc)
-   **Contínuas**: quando os possíveis valores são resultado de medições (exemplos: massa, altura, tempo, etc)

## Coeficiente de Correlação de Pearson

O coeficiente de correlação de Pearson é uma medida que verifica o grau de relação linear entre duas variáveis quantitativas. Este coeficiente varia entre os valores -1 e 1. O valor zero significa que não há relação linear entre as variáveis. Quando o valor do coeficiente $r$ é negativo, diz-se existir uma relação de grandeza inversamente proporcional entre as variáveis. Analogamente, quando $r$ é positivo, diz-se que as duas variáveis são diretamente proporcionais.

O coeficiente de correlação de Pearson é normalmente representado pela letra $r$ e a sua fórmula de cálculo é:

$$
r_{Pearson} = \frac{\displaystyle \sum_{i=1}^{n} \left [ \left(x_i-\bar{x}\right) \left(y_i-\bar{y}\right) \right]}{\sqrt{\displaystyle \sum_{i=1}^{n} x_i^2 - n\bar{x}^2}  \times \sqrt{\displaystyle \sum_{i=1}^{n} y_i^2 - n\bar{y}^2}}
$$

Onde:

-   $x_i =$ i-ésimo valor da variável $X$
-   $y_i =$ i-ésimo valor da variável $Y$
-   $\bar{x} =$ média dos valores da variável $X$
-   $\bar{y} =$ média dos valores da variável $Y$

Vale ressaltar que o coeficiente de Pearson é paramétrico e, portanto, sensível quanto à normalidade (simetria) dos dados.

## Teste de Correlação de Pearson

O coeficiente de correlação linear de Pearson indica a força e a direção do relacionamento linear entre duas variáveis quantitativas. É um índice adimensional com valores situados entre -1 e 1, no qual o valor -1 representa total correlação linear negativa entre as variáveis (quando o valor de uma variável cresce, o valor da outra diminui) e o valor 1 representa total correlação linear positiva entre elas (ambas crescem simultaneamente). Esse coeficiente é obtido por meio da fórmula:

$$r_{Pearson} = \frac{\displaystyle \sum_{i=1}^{n} \left [ \left(x_i-\bar{x}\right) \left(y_i-\bar{y}\right) \right]}{\sqrt{\displaystyle \sum_{i=1}^{n} x_i^2 - n\bar{x}^2} \sqrt{\displaystyle \sum_{i=1}^{n} y_i^2 - n\bar{y}^2}}$$

\noindent em que

-   $x_i=$ i-ésimo valor da variável $X$

-   $y_i=$ i-ésimo valor da variável $Y$

-   $\bar{x}=$ média dos valores da variável $X$

-   $\bar{y}=$ média dos valores da variável $Y$

-   $r_{Pearson}=$ coeficiente de correlação linear de Pearson amostral

Para o teste de correlação de Pearson, tem-se as seguintes hipóteses:

\hipoteses{Não há correlação linear entre as variáveis $X$ e $Y$ $\left(\rho_{Pearson} = 0 \right)$ }{Há correlação linear entre as variáveis $X$ e $Y$ $\left(\rho_{Pearson} \neq 0 \right)$ }

em que $\rho_{Pearson}$ é o parâmetro a ser testado: coeficiente de correlação linear populacional.

Se X e Y tem distribuição normal, tem-se que a estatística do teste é dada por:

$$t_{Pearson} = \frac{r_{Pearson} \sqrt{n-2}}{\sqrt{1-r_{Pearson}^2}} \sim t_{n-2} $$

Assim, sob $H_{0}$, $t_{Pearson}$ segue uma distribuição \textit{t}-Student com ($n - 2$) graus de liberdade.


# Análises

## Receita média das lojas registrada nos anos de 1880 até 1889
Nessa análise, será observada, por ano, a média do faturamento bruto anual de cada uma das lojas descritas no plano amostral, no período de 1880 a 1889, com o objetivo de compreender se houve aumento ou diminuição da receita média ao longo desses anos. Serão analisadas duas variáveis: o ano das vendas, uma variável quantitativa discreta, e a receita média das lojas, que é uma variável quantitativa contínua, expressa em reais. Os valores consideram a cotação atual do dólar a R$ 5,31 para referência.
```{r}
dadosGerais <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx")

dadosVenda <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet="infos_vendas")

dadosProdutos <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet="infos_produtos")

dadosIntermediarios <- dadosGerais %>% left_join(dadosVenda, by="SaleID")

dadosFinais <- dadosIntermediarios %>% left_join(dadosProdutos, by="ItemID")

dadosFinais$Receita <- dadosFinais$UnityPrice * dadosFinais$Quantity * 5.31

dadosFinais$Ano <- format(as.Date(dadosFinais$Date), "%Y")
```

```{r fig-receita, fig.cap="Gráfico de linhas da receita média anual de 1880 a 1889"}


receitaLojaPorAno <- dadosFinais %>% group_by(Ano,StoreID) %>% summarise(receitaTOTALloja = sum(Receita))

receitaTOTALmedia <- receitaLojaPorAno %>% group_by(Ano) %>% summarise(receitaMESIA = mean(receitaTOTALloja))

ggplot(receitaTOTALmedia) +
aes(x=Ano, y=receitaMESIA, group=1) +
geom_line(size=1,colour="#A11D21") + geom_point(colour="#A11D21",
size=2) +
labs( y="Receita Total Média das Lojas") +
theme_estat(    plot.title = element_text(hjust = 1),
)
ggsave("series_uni.pdf", width = 158, height = 93, units = "mm")


estat_colors <- c(
"#A11D21", "#003366", "#CC9900",
"#663333", "#FF6600",
"#999966", "#006606", "#008091",
"#041835", "#666666" )

```




\begin{table}[H]
\centering
\caption{Média das receitas e variação percentual entre 1880 e 1889}
\label{tbl:receitas}
\begin{tabular}{|c|c|c|}
\hline
\textbf{Anos} & \textbf{Média das receitas} & \textbf{Porcentagem de aumento} \\
\hline
1880 & 105.399,0 & - \\
1881 & 112.110,0 & 6,37\% \\
1882 & 112.452,4 & 0,31\% \\
1883 & 116.856,9 & 3,92\% \\
1884 & 119.989,8 & 2,68\% \\
1885 & 129.969,0 & 8,32\% \\
1886 & 130.989,2 & 0,78\% \\
1887 & 135.444,8 & 3,40\% \\
1888 & 133.757,6 & −1,25\% \\
1889 & 155.009,1 & 15,89\% \\
\hline
\textbf{Total} & 1.252.977,8 & 47,07\% \\
\hline
\end{tabular}
\label{tab:receitas}
\end{table}

De modo geral, ao analisar a tabela acima e a $\ref{fig-receita}$, é perceptível uma tendência de crescimento contínuo, com algumas flutuações pontuais que merecem destaque. A série indica que, ao final do período, as receitas atingiram o maior valor da década, refletindo um comportamento fortemente ascendente.
  
### 1880 a 1885 
  
Nos primeiros 4 anos, o aumento ocorreu de forma gradual, com o acréscimo médio de aproximadamente 3,3% ao ano, o que sugere uma fase inicial estável com crescimento moderado. De 1884 a 1885, verifica-se uma aceleração mais evidente no ritmo de crescimento, quando a receita média chega próxima da faixa de 130 mil reais.

### 1885 a 1889

O período de 1885 a 1888 apresenta pequenas oscilações, com sutil crescimento até 1887, e uma ligeira redução em 1888. Essa pequena queda, de cerca de 1,25%, não altera a trajetória geral da série, podendo indicar uma correção natural após aumentos sucessivos. Em seguida, o ano de 1889 evidencia o maior salto positivo de todo período, com crescimento estimado em mais de 15% em relação ao ano anterior.

### Todo o período

Ao analisar o comportamento geral, constata-se que o crescimento entre 1880 e 1889 foi de aproximadamente 47%, com uma média de crescimento anual próxima de 5%. A partir disso, constata-se que, mesmo diante de pequenas variações, houve uma tendencia de expansão ao longo da década.

## Variação de peso por altura dos clientes.

Nessa análise será observada a relação entre duas variáveis fundamentais em estudos corporais: peso (em quilogramas) e altura (em centímetros) dos clientes. A análise busca compreender de que forma essas variáveis se comportam em conjunto, verificando se há uma tendência de aumento do peso conforme cresce a altura, se ocorre o oposto ou se não existe uma relação significativa entre elas. Com base nos dados coletados das duas variáveis quantitativas contínuas, será aplicada uma análise estatística descritiva, permitindo identificar padrões, correlações e possíveis tendências que auxiliem na compreensão do perfil físico dos clientes.

```{r}
  dadosClientes <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet="infos_clientes")

dadosClientes$Peso = dadosClientes$Weight_lbs*0.4535

dadosClientes$Altura = dadosClientes$Height_dm*10
```
### Análises relacionadas à altura
```{r fig-altura, fig.cap="Boxplot da altura dos clientes."}
  ggplot(dadosClientes) +
aes(x=factor(""), y=Altura) +
geom_boxplot(fill=c("#A11D21"), width = 0.5) +
guides(fill=FALSE) +
stat_summary(fun="mean", geom="point", shape=23, size=3, fill="white")+
labs(x="", y="Altura do cliente (cm)")+
theme_estat()

```

```{r}
  print_quadro_resumo <- function(data, var_name, title = "Medidas resumo da variável",
                                label = "quad:quadro_resumo1") {

  var_name <- substitute(var_name)
  
  
  resumo <- data %>%
    summarize(
      `Média` = round(mean(!!sym(var_name), na.rm = TRUE), 2),
      `Desvio Padrão` = round(sd(!!sym(var_name), na.rm = TRUE), 2),
      `Variância` = round(var(!!sym(var_name), na.rm = TRUE), 2),
      `Mínimo` = round(min(!!sym(var_name), na.rm = TRUE), 2),
      `1º Quartil` = round(quantile(!!sym(var_name), probs = .25, na.rm = TRUE), 2),
      `Mediana` = round(quantile(!!sym(var_name), probs = .5, na.rm = TRUE), 2),
      `3º Quartil` = round(quantile(!!sym(var_name), probs = .75, na.rm = TRUE), 2),
      `Máximo` = round(max(!!sym(var_name), na.rm = TRUE), 2)
    ) %>%
    t() %>%
    as.data.frame() %>%
    rownames_to_column(var = "Estatística")
  resumo$Estatística <- stringi::stri_trans_general(resumo$Estatística, "Latin-ASCII")

  linhas <- paste0(
    apply(resumo, 1, function(row) {
      paste0(row[1], " & ", row[2], " \\\\")
    }),
    collapse = "\n"
  )

  latex <- paste0(
"\\begin{quadro}[H]\n",
"\\caption{", title, "}\n",
"\\centering\n",
"\\begin{adjustbox}{max width=\\textwidth}\n",
"\\begin{tabular}{|l|r|}\n",
"\\hline\n",
"\\textbf{Estatística} & \\textbf{Valor}\\\\\n",
"\\hline\n",
linhas, "\n",
"\\hline\n",
"\\end{tabular}\n",
"\\label{", label, "}\n",
"\\end{adjustbox}\n",
"\\end{quadro}\n"
  )

  knitr::asis_output(latex)
}

print_quadro_resumo(dadosClientes, Altura)

```

Em termos gerais, de acordo com o que pode ser percebido na tabela acima e na $\ref{fig-altura}$, a altura dos clientes demonstra-se com uma variação moderada entre os indivíduos, com desvio padrão de 9,9cm, o que indica que a maioria dos clientes possui altura próxima à média, que é 171,48cm. Ainda na $\ref{fig-altura}$, é possível identificar outliers correspondentes aos clientes mais altos e mais baixos, sendo a maior altura registrada de 200 cm e a menor de 150 cm. Além disso, o valor da mediana (171,8cm), está muito próxima da média, sugerindo uma distribuição bastante simétrica.

### Análises relacionadas ao peso

```{r fig-peso, fig.cap="Boxplot do peso dos clientes."}
  ggplot(dadosClientes) +
aes(x=factor(""), y=Peso) +
geom_boxplot(fill=c("#A11D21"), width = 0.5) +
guides(fill=FALSE) +
stat_summary(fun="mean", geom="point", shape=23, size=3, fill="white")+
labs(x="", y="Peso do cliente (kg)")+
theme_estat()
```

```{r}
print_quadro_resumo(dadosClientes, Peso)

```

Considerando os dados apresentados na tabela acima e na $\ref{fig-peso}$, o peso dos clientes também revela uma variação moderada entre os indivíduos, com desvio padrão de 11,9 kg, o que indica que a maioria apresenta valores próximos à média de 75,17 kg. Ainda na $\ref{fig-peso}$, é possível identificar outliers que representam os clientes com maiores e menores pesos, sendo o menor valor observado de 44,99 kg e o maior de 119,28 kg. Além disso, assim como na altura, a mediana (75,28 kg) encontra-se praticamente igual à média, sugerindo uma distribuição equilibrada e relativamente simétrica dos dados.

### Relação entre as variáveis
```{r fig-rel-peso,fig.cap="Gráfico de dispersão do peso pela altura."}

ggplot(dadosClientes,aes(x = Altura, y = Peso)) +
geom_point(colour = "#A11D21", size = 3, alpha = 0.3) + labs( x="Altura (cm)", y="Peso do cliente (kg)") +  geom_smooth(method = "lm", colour = "#003366", linewidth = 1) +  
theme_estat()
ggsave("disp_uni.pdf", width = 158, height = 93, units = "mm")

```


A $\ref{fig-rel-peso}$ apresenta uma tendência de crescimento clara, que significa, de maneira geral, que à medida que a altura aumenta, o peso tende também a crescer. Dessa maneira, com os pontos moderadamente concentrados em torno de uma linha ascendente, é perceptível uma relação linear positiva entre as duas variáveis apesar de existir leve dispersão. Além disso, o coeficiente de correlação de Pearson, que é uma medida estatística que indica a força e a direção da relação linear entre duas variáveis numéricas variando sua força de relação entre -1 (relação negativa) e 1 (relação positiva), de 0,697 também reforça uma correlação positiva forte entre as variáveis. 

## Idade dos clientes de Âmbar Seco a depender da loja.

Nessa análise serão observadas medidas de resumo das idades (em anos) dos clientes com o intuito de compreender melhor o perfil etário de tais em três cenários diferentes: os dados etários gerais da amostra disponibilizada, que contam com todas cidades e lojas, as análises na cidade de Âmbar Seco sem diferenciação por loja, e a análise que leva em conta as lojas de Âmbar Seco individualmente.Tais dados ajudarão a ter um melhor entendimento de quais são os perfis de idades dos clientes em diversos aspectos.


### Idade de todos clientes da amostra

Nessa análise, serão consideradas as idades de todos clientes disponibilizadas em todo plano amostral, sem diferenciação por qualquer variável. Com isso, é possível ter uma análise mais ampla e comparativa com cenários mais específicos.

```{r}
  dadosGerais <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet = "relatorio_vendas")

dadosLojas <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet = "infos_lojas")

dadosClientes <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet = "infos_clientes")

dadosIntermediarioss <- dadosGerais %>% left_join(dadosLojas, by="StoreID")

dadosFinaisss <- dadosIntermediarioss %>% left_join(dadosClientes,by="ClientID")

dadosFinaiss <- distinct(dadosFinaisss,StoreID,NameStore,ClientID,Age,CityID)

```

```{r fig-idade-geral, fig.cap= "Boxplot da Idade"}
ggplot(dadosFinaiss) +
aes(x=factor(""),y=dadosFinaiss$Age) +
geom_boxplot(fill=c("#A11D21"), width = 0.5) +
guides(fill=FALSE) +
stat_summary(fun="mean", geom="point", shape=23, size=3, fill="white")+
labs( x="", y="Idade Geral (anos)")+
theme_estat()
```

```{r}
print_quadro_resumo(dadosFinaiss, Age)
```

Levando em conta a tabela acima e a $\ref{fig-idade-geral}$, a distribuição geral das idades dos clientes apresenta uma média de aproximadamente 37,5 anos, indicando que a maioria dos indivíduos se encontra na faixa etária adulta . O desvio padrão de 12,8 anos evidencia uma variação moderada nas idades observadas, sugerindo que há certa diferença no público analisado. A mediana de 36 anos confirma a concentração dos valores em torno da média, enquanto o intervalo entre o primeiro e o terceiro quartil (28 a 44 anos) mostra que metade dos clientes possui idade dentro dessa faixa. Os valores mínimo e máximo, 15 e 80 anos, indicam a presença de indivíduos tanto jovens quanto idosos na amostra, ainda que estes representem casos menos frequentes (outliers). 

### Idade dos clientes de Âmbar Seco

Nessa outra análise, é levado em conta somente os dados de idades da pequena cidade de Âmbar Seco, com intuito de aprofundar mais no cenário local antes da análise pedida.

```{r fig-idade-ambar, fig.cap= "Boxplot da Idade"}
  cidadeAmbar <- dadosFinaiss[dadosFinaiss$CityID == 2,]

  ggplot(cidadeAmbar) +
aes(x=factor(""),y=cidadeAmbar$Age) +
geom_boxplot(fill=c("#A11D21"), width = 0.5) +
guides(fill=FALSE) +
stat_summary(fun="mean", geom="point", shape=23, size=3, fill="white")+
labs(x="", y="Idade em Âmbar Seco (anos)")+
theme_estat()
```

```{r}
print_quadro_resumo(cidadeAmbar, Age)

```

Nessa outra análise, levando em conta a tabela de medidas acima e a $\ref{fig-idade-ambar}$, é perceptível que a média de idade é de 35,9 anos, ligeiramente inferior à média geral da amostra (37,5 anos), indicando um público um pouco mais jovem. O desvio padrão de 10,5 anos e a variância de 109,4 mostram uma dispersão menor em comparação à amostra total, o que sugere maior homogeneidade nas idades dos clientes locais. A mediana de 35 anos reforça essa concentração em torno da média.

### Idade dos clientes de Âmbar seco a partir da loja

Nessa última análise, será possível observar um cenário mais específico, e que foi o proposto desde o início: a relação etária nas lojas de Âmbar Seco. 

```{r fig-idade-lojas, fig.cap= "Boxplot bivariado da idade pelo nome da loja."}
  ggplot(cidadeAmbar) +
aes(x = reorder(NameStore, Age, FUN = median), y = Age) +
geom_boxplot(fill = c("#A11D21"), width = 0.5) +
stat_summary(
fun = "mean", geom = "point", shape = 23, size = 3, fill = "white"
) +
labs( x = "Nome da loja", y = "Idade dos clientes (anos)") +
theme_estat()
ggsave("box_bi.pdf", width = 158, height = 93, units = "mm")
```

```{r}

print_quadro_resumo_grande <- function(data, var_name,
                                title = "Medidas resumo da variável",
                                label = "quad:quadro_resumo1") {

  var_name <- substitute(var_name)
  group_var <- sym("NameStore")
  
  resumo <- data %>%
    group_by(!!group_var) %>%
    summarize(
      `Média` = round(mean(!!sym(var_name), na.rm = TRUE), 2),
      `Desvio Padrão` = round(sd(!!sym(var_name), na.rm = TRUE), 2),
      `Variância` = round(var(!!sym(var_name), na.rm = TRUE), 2),
      `Mínimo` = round(min(!!sym(var_name), na.rm = TRUE), 2),
      `1º Quartil` = round(quantile(!!sym(var_name), probs = .25, na.rm = TRUE), 2),
      `Mediana` = round(quantile(!!sym(var_name), probs = .5, na.rm = TRUE), 2),
      `3º Quartil` = round(quantile(!!sym(var_name), probs = .75, na.rm = TRUE), 2),
      `Máximo` = round(max(!!sym(var_name), na.rm = TRUE), 2)
    ) %>%
    pivot_longer(-!!group_var, names_to = "Estatística", values_to = "Valor") %>%
    pivot_wider(names_from = !!group_var, values_from = Valor) %>%
    mutate(Estatística = stringi::stri_trans_general(Estatística, "Latin-ASCII"))
  
  linhas <- apply(resumo, 1, function(row) {
    paste0(
      row[1], " & ",
      paste(row[-1], collapse = " & "),
      " \\\\"
    )
  }) %>% paste0(collapse = "\n")
  
latex <- paste0(
  "\\begin{quadro}[H]\n",
  "\\caption{", title, "}\n",
  "\\centering\n",
  "\\begin{adjustbox}{max width=\\textwidth}\n",
  "\\begin{tabular}{|l|", paste(rep("r", ncol(resumo) - 1), collapse = " "), "|r|}\n",
  "\\hline\n",
  "\\textbf{Estatística} & ",
  paste0(paste0("\\textbf{", names(resumo)[-1], "}"), collapse = " & "),
  "\\\\\n",
  "\\hline\n",
  linhas, "\n",
  "\\hline\n",
  "\\end{tabular}\n",
  "\\label{", label, "}\n",
  "\\end{adjustbox}\n",
  "\\end{quadro}\n"
)

  
  knitr::asis_output(latex)
}

print_quadro_resumo_grande(cidadeAmbar, Age, title = "Medidas resumo da idade por cidade")


```


Considerando a tabela de medidas resumo de cada loja, e a $\ref{fig-idade-lojas}$ , é notável diferenças no perfil etário das quatro lojas avaliadas em Âmbar Seco. O boxplot indica que as lojas Ferraria Seca e Saloon concentram clientes mais jovens em comparação às outras duas lojas, com uma mediana próxima a 30 anos. Além disso, ambas apresentam uma maior dispersão entre os dados (desvio padrão mais alto de 13,31 e 12,70 respectivamente), o que indica um atendimento de públicos variados.

A loja Banco Careca apresenta um comportamento mais homogêneo, com menor dispersão (desvio-padrão de 5,57) e idades concentradas entre 25 (mínimo) e 44 anos (máximo). Sua mediana (34 anos) e média (34,92) estão bastante próximas, o que indica uma distribuição mais simétrica. Esse padrão demonstra que o público dessa unidade é mais estável em termos de faixa etária.

Já a Vendinha Rápida se destaca por possuir o público mais velho entre as quatro lojas. A média de idade (40,35 anos) e a mediana (41 anos) são superiores às das demais unidades, com valores concentrados entre 35 e 46 anos e pouca dispersão (desvio-padrão de 6,03). Isso aponta para uma clientela mais velha e com menor variação entre as idades.

Dessa maneira, é possível concluir que as lojas apresentam diferenças consideráveis no perfil etário de seus públicos.Esses resultados podem refletir diferenças no tipo de produto oferecido, na localização ou no posicionamento de cada loja dentro do mercado local.


## O top 3 produtos mais vendidos nas top 3 lojas com maior receita em 1889.

Nessa análise será observada a relação entre duas variáveis fundamentais para o desempenho comercial das lojas: os produtos mais vendidos e as lojas com maior receita no ano de 1889. A análise busca compreender de que forma essas variáveis se comportam em conjunto, verificando quais produtos concentram as maiores vendas nas principais lojas, se há predominância de determinados itens em alguma loja específica ou se a distribuição de vendas é equilibrada entre os produtos. Com base nos dados coletados dessas variáveis quantitativas, será aplicada uma análise estatística descritiva, permitindo identificar padrões, tendências de consumo e possíveis preferências dos clientes, auxiliando na compreensão do desempenho e perfil comercial das lojas.


### As três lojas com maior receita no ano de 1889.

```{r fig-tres-maiores, fig.cap= "Gráfico de colunas da receita das lojas."}
relatorio_vendas  <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx")

infos_vendas <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet="infos_vendas")

infos_produtos <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet="infos_produtos")

dadosIntermediarios <- relatorio_vendas %>% left_join(infos_vendas, by="SaleID")

dadosFinais <- dadosIntermediarios %>% left_join(infos_produtos, by="ItemID")

dadosFinais$Receita <- dadosFinais$UnityPrice * dadosFinais$Quantity * 5.31

dadosFinais$Ano <- format(as.Date(dadosFinais$Date), "%Y")


dadosLojaz <- read_excel("C:/Users/Breno/Downloads/relatorio_old_town_road (2).xlsx", sheet="infos_lojas")

dadosUltimos <- dadosFinais %>% left_join(dadosLojaz, by="StoreID")

dados_1889 <- dadosUltimos %>%
  filter(Ano == 1889)

classes <- dados_1889 %>%
  filter(!is.na(NameStore)) %>%
  count(NameStore, wt = Receita) %>%
  mutate(
    freq = n,
    relative_freq = round((freq / sum(freq)) * 100, 2),
    freq = gsub("\\.", ",", relative_freq) %>% paste("%", sep = ""),
    label = str_c(round(n,1), " (", freq, ")") %>% str_squish()
  ) %>%
  slice_max(n, n = 3)

ggplot(classes) + aes(x = fct_reorder(NameStore, n, .desc=T), y = n, label = label) +
  geom_bar(stat = "identity", fill = "#A11D21", width = 0.7) +
  geom_text(
    position = position_dodge(width = .9),
    vjust = -0.5, hjust = .5,
    size = 3
  ) +
  labs( x = "Nome da loja", y = "Receita da loja em 1889 (em R$)") +
  theme_estat()

ggsave("colunas-uni-freq.pdf", width = 158, height = 93, units = "mm")

```

A partir do que está descrito na $\ref{fig-tres-maiores}$, é possível concluir que as três lojas com maior receita no ano de 1889 foram: Loja "Ouro Fino" com aproximadamente 7,1% de todo faturamento do ano, Loja "TendTudo" ligeiramente abaixo da anterior com 7% da receita total, e "Ferraria Apache",com 6,5% da receita. A partir disso será feita a análise individual de cada uma dessas lojas para que seja analisado quais produtos foram predominantes nas vendas desse ano.

### Os três itens mais vendidos nas três lojas com maior receita em 1889.

Nessa análise, será possível observar a distribuição dos produtos mais vendidos em cada uma das três lojas com maior faturamento em 1889.

```{r fig-bivd, fig.cap= "Gráfico de colunas da loja pela frequência de vendas do produto. "}
top3 <- classes$NameStore

top3_vendas <- dados_1889 %>%
  filter(NameStore %in% top3)


resumo_itens <- top3_vendas %>%
  group_by(NameStore, ItemID) %>%
  summarise(Total_Vendido = sum(Quantity), .groups = "drop")

resumo_itens$Produto <- case_when(
  resumo_itens$ItemID == 1  ~ "Botas de Couro",
  resumo_itens$ItemID == 3  ~ "Chapéu de Couro",
  resumo_itens$ItemID == 4  ~ "Colt.45",
  resumo_itens$ItemID == 5  ~ "Espingarda",
  resumo_itens$ItemID == 6  ~ "Machado",
  resumo_itens$ItemID == 10 ~ "Whisky",
  TRUE ~ "Outro"
)

resumo_top3_produtos <- resumo_itens %>%
  group_by(NameStore) %>%
  slice_max(Total_Vendido, n = 3) %>%
  ungroup()

resumo_final <- resumo_top3_produtos %>%
  group_by(NameStore) %>%
  mutate(
    perc = round((Total_Vendido / sum(Total_Vendido)) * 100, 2),
    perc_label = gsub("\\.", ",", perc),
    legendas = paste0(Total_Vendido, " (", perc_label, "%)")
  )  %>%
  ungroup()


ggplot(resumo_final) +
  aes(
    x = fct_reorder(NameStore, Total_Vendido, .desc = TRUE),
    y = Total_Vendido,
    fill = Produto,
    label = legendas
  ) +
  geom_col(position = position_dodge2(preserve = "single", padding = 0)) +
  geom_text(
    position = position_dodge(width = 0.9),
    vjust = -0.5, hjust = 0.5,
    size = 2.1
  ) +
  labs(
    x = "Loja",
    y = "Frequência",
    fill = "Produto"
  )+
  theme_estat()
ggsave("colunas-bi-freq.pdf", width = 158, height = 93, units = "mm")

```

A partir dos valores apresentados na $\ref{fig-bivd}$, pode-se concluir que, na loja "Ouro Fino" em 1889, o produto mais vendido foi: "Botas de Couro" , seguido pelo "Whisky", e em terceiro "Chapéu de Couro". Na loja "TendTudo", o mais vendido foi "Espingarda" seguido por: "Whisky" e "Colt. 45" respectivamente. Por último, na "Ferraria Apache", o campeão de vendas foi: " Chapéu de couro" seguido por "Espingarda" e em terceiro seguem dois itens empatados com 41 vendas, "Machado" e "Whisky".

Dessa maneira, a partir da análise da $\ref{fig-bivd}$ das três lojas em 1889, observa-se que cada estabelecimento apresenta um padrão de vendas distinto, com produtos líderes diferentes em cada caso. Apesar disso, certos itens, como "Whisky" e "Chapéu de Couro", aparecem em mais de uma loja entre os mais vendidos, indicando uma demanda relativamente alta desses produtos no período. Além disso, a variação percentual entre os produtos mais vendidos mostra que, embora cada loja tenha seu produto mais vendido, a composição do top 3 evidencia a diversidade nas preferências dos clientes e na estratégia de vendas de cada loja.

# Conclusão

Com base nas análises realizadas a partir do banco de dados disponibilizado por João Sábio, proprietário da Old Town Road, foi possível obter uma visão abrangente sobre o desempenho das lojas e o perfil dos clientes da região estudada. Os resultados apresentados permitem identificar tendências relevantes para o planejamento estratégico e a tomada de decisão do cliente no contexto comercial do faroeste.

De maneira geral, considerando todas análises solicitadas, observou-se um crescimento consistente da receita entre 1880 e 1889, totalizando cerca de 47% no período e média anual próxima de 5%, o que evidencia uma tendência de expansão ao longo da década. As análises de correlação apontaram relação linear positiva moderadamente forte, entre as variáveis "altura" e "peso", indicando que o aumento de uma tende a acompanhar o da outra. Verificaram-se também diferenças marcantes no perfil etário das lojas avaliadas: unidades como Ferraria Seca e Saloon concentram públicos mais jovens e heterogêneos, enquanto Banco Careca e Vendinha Rápida atendem clientelas mais homogêneas e de faixas etárias mais elevadas. Por fim, em 1889, as três lojas de maior receita apresentaram padrões de venda distintos, com produtos líderes variados — ainda que itens como Whisky e Chapéu de Couro se destaquem em mais de um estabelecimento —, refletindo diversidade nas preferências dos consumidores e nas estratégias comerciais de cada unidade.

Destarte, os resultados obtidos indicam que o mercado regional analisado apresenta crescimento consistente, consumidores com perfis bem definidos e tendências comerciais diversificadas entre as unidades de negócio. As informações geradas a partir deste estudo fornecem dados concretos para o planejamento e expansão das atividades da Old Town Road, apoiando decisões futuras de investimento, segmentação de público e otimização de portfólio de produtos.